package gcode_test

import (
	"os"
	"strings"
	"testing"

	"github.com/leftmike/gcode"
)

func TestArc(t *testing.T) {
	cases := []struct {
		s       string
		actions []action
	}{
		{s: `
G21
G17
F1
G0 X1 Y2
G2 X2 Y1 R1 P9
`,
			actions: []action{
				{cmd: setFeed, f: 1.0},
				{cmd: rapidTo, x: 1.0000, y: 2.0000, z: 0.0000},
				{cmd: linearTo, x: 1.1005, y: 1.9949, z: 0.0000},
				{cmd: linearTo, x: 1.2000, y: 1.9798, z: 0.0000},
				{cmd: linearTo, x: 1.2975, y: 1.9547, z: 0.0000},
				{cmd: linearTo, x: 1.3920, y: 1.9200, z: 0.0000},
				{cmd: linearTo, x: 1.4825, y: 1.8759, z: 0.0000},
				{cmd: linearTo, x: 1.5681, y: 1.8230, z: 0.0000},
				{cmd: linearTo, x: 1.6479, y: 1.7617, z: 0.0000},
				{cmd: linearTo, x: 1.7212, y: 1.6927, z: 0.0000},
				{cmd: linearTo, x: 1.7872, y: 1.6167, z: 0.0000},
				{cmd: linearTo, x: 1.8452, y: 1.5345, z: 0.0000},
				{cmd: linearTo, x: 1.8946, y: 1.4468, z: 0.0000},
				{cmd: linearTo, x: 1.9350, y: 1.3546, z: 0.0000},
				{cmd: linearTo, x: 1.9659, y: 1.2588, z: 0.0000},
				{cmd: linearTo, x: 1.9871, y: 1.1604, z: 0.0000},
				{cmd: linearTo, x: 1.9982, y: 1.0604, z: 0.0000},
				{cmd: linearTo, x: 1.9992, y: 0.9597, z: 0.0000},
				{cmd: linearTo, x: 1.9901, y: 0.8595, z: 0.0000},
				{cmd: linearTo, x: 1.9709, y: 0.7607, z: 0.0000},
				{cmd: linearTo, x: 1.9420, y: 0.6643, z: 0.0000},
				{cmd: linearTo, x: 1.9035, y: 0.5713, z: 0.0000},
				{cmd: linearTo, x: 1.8558, y: 0.4827, z: 0.0000},
				{cmd: linearTo, x: 1.7994, y: 0.3993, z: 0.0000},
				{cmd: linearTo, x: 1.7350, y: 0.3219, z: 0.0000},
				{cmd: linearTo, x: 1.6631, y: 0.2515, z: 0.0000},
				{cmd: linearTo, x: 1.5845, y: 0.1886, z: 0.0000},
				{cmd: linearTo, x: 1.5000, y: 0.1340, z: 0.0000},
				{cmd: linearTo, x: 1.4104, y: 0.0881, z: 0.0000},
				{cmd: linearTo, x: 1.3167, y: 0.0515, z: 0.0000},
				{cmd: linearTo, x: 1.2197, y: 0.0244, z: 0.0000},
				{cmd: linearTo, x: 1.1205, y: 0.0073, z: 0.0000},
				{cmd: linearTo, x: 1.0201, y: 0.0002, z: 0.0000},
				{cmd: linearTo, x: 0.9195, y: 0.0032, z: 0.0000},
				{cmd: linearTo, x: 0.8197, y: 0.0164, z: 0.0000},
				{cmd: linearTo, x: 0.7218, y: 0.0395, z: 0.0000},
				{cmd: linearTo, x: 0.6266, y: 0.0723, z: 0.0000},
				{cmd: linearTo, x: 0.5353, y: 0.1145, z: 0.0000},
				{cmd: linearTo, x: 0.4486, y: 0.1657, z: 0.0000},
				{cmd: linearTo, x: 0.3676, y: 0.2254, z: 0.0000},
				{cmd: linearTo, x: 0.2929, y: 0.2929, z: 0.0000},
				{cmd: linearTo, x: 0.2254, y: 0.3676, z: 0.0000},
				{cmd: linearTo, x: 0.1657, y: 0.4486, z: 0.0000},
				{cmd: linearTo, x: 0.1145, y: 0.5353, z: 0.0000},
				{cmd: linearTo, x: 0.0723, y: 0.6266, z: 0.0000},
				{cmd: linearTo, x: 0.0395, y: 0.7218, z: 0.0000},
				{cmd: linearTo, x: 0.0164, y: 0.8197, z: 0.0000},
				{cmd: linearTo, x: 0.0032, y: 0.9195, z: 0.0000},
				{cmd: linearTo, x: 0.0002, y: 1.0201, z: 0.0000},
				{cmd: linearTo, x: 0.0073, y: 1.1205, z: 0.0000},
				{cmd: linearTo, x: 0.0244, y: 1.2197, z: 0.0000},
				{cmd: linearTo, x: 0.0515, y: 1.3167, z: 0.0000},
				{cmd: linearTo, x: 0.0881, y: 1.4104, z: 0.0000},
				{cmd: linearTo, x: 0.1340, y: 1.5000, z: 0.0000},
				{cmd: linearTo, x: 0.1886, y: 1.5845, z: 0.0000},
				{cmd: linearTo, x: 0.2515, y: 1.6631, z: 0.0000},
				{cmd: linearTo, x: 0.3219, y: 1.7350, z: 0.0000},
				{cmd: linearTo, x: 0.3993, y: 1.7994, z: 0.0000},
				{cmd: linearTo, x: 0.4827, y: 1.8558, z: 0.0000},
				{cmd: linearTo, x: 0.5713, y: 1.9035, z: 0.0000},
				{cmd: linearTo, x: 0.6643, y: 1.9420, z: 0.0000},
				{cmd: linearTo, x: 0.7607, y: 1.9709, z: 0.0000},
				{cmd: linearTo, x: 0.8595, y: 1.9901, z: 0.0000},
				{cmd: linearTo, x: 0.9597, y: 1.9992, z: 0.0000},
				{cmd: linearTo, x: 1.0604, y: 1.9982, z: 0.0000},
				{cmd: linearTo, x: 1.1604, y: 1.9871, z: 0.0000},
				{cmd: linearTo, x: 1.2588, y: 1.9659, z: 0.0000},
				{cmd: linearTo, x: 1.3546, y: 1.9350, z: 0.0000},
				{cmd: linearTo, x: 1.4468, y: 1.8946, z: 0.0000},
				{cmd: linearTo, x: 1.5345, y: 1.8452, z: 0.0000},
				{cmd: linearTo, x: 1.6167, y: 1.7872, z: 0.0000},
				{cmd: linearTo, x: 1.6927, y: 1.7212, z: 0.0000},
				{cmd: linearTo, x: 1.7617, y: 1.6479, z: 0.0000},
				{cmd: linearTo, x: 1.8230, y: 1.5681, z: 0.0000},
				{cmd: linearTo, x: 1.8759, y: 1.4825, z: 0.0000},
				{cmd: linearTo, x: 1.9200, y: 1.3920, z: 0.0000},
				{cmd: linearTo, x: 1.9547, y: 1.2975, z: 0.0000},
				{cmd: linearTo, x: 1.9798, y: 1.2000, z: 0.0000},
				{cmd: linearTo, x: 1.9949, y: 1.1005, z: 0.0000},
				{cmd: linearTo, x: 2.0000, y: 1.0000, z: 0.0000},
			},
		},
		{s: `
G21
G17
F1
G0 X1 Y2
G91
G2 X1 Y-1 R1 P1
`,
			actions: []action{
				{cmd: setFeed, f: 1.0},
				{cmd: rapidTo, x: 1.0000, y: 2.0000, z: 0.0000},
				{cmd: linearTo, x: 1.1045, y: 1.9945, z: 0.0000},
				{cmd: linearTo, x: 1.2079, y: 1.9781, z: 0.0000},
				{cmd: linearTo, x: 1.3090, y: 1.9511, z: 0.0000},
				{cmd: linearTo, x: 1.4067, y: 1.9135, z: 0.0000},
				{cmd: linearTo, x: 1.5000, y: 1.8660, z: 0.0000},
				{cmd: linearTo, x: 1.5878, y: 1.8090, z: 0.0000},
				{cmd: linearTo, x: 1.6691, y: 1.7431, z: 0.0000},
				{cmd: linearTo, x: 1.7431, y: 1.6691, z: 0.0000},
				{cmd: linearTo, x: 1.8090, y: 1.5878, z: 0.0000},
				{cmd: linearTo, x: 1.8660, y: 1.5000, z: 0.0000},
				{cmd: linearTo, x: 1.9135, y: 1.4067, z: 0.0000},
				{cmd: linearTo, x: 1.9511, y: 1.3090, z: 0.0000},
				{cmd: linearTo, x: 1.9781, y: 1.2079, z: 0.0000},
				{cmd: linearTo, x: 1.9945, y: 1.1045, z: 0.0000},
				{cmd: linearTo, x: 2.0000, y: 1.0000, z: 0.0000},
			},
		},
		{s: `
G21
G17
F1
G0 X1 Y2
G3 X2 Y1 R1 P1
`,
			actions: []action{
				{cmd: setFeed, f: 1.0},
				{cmd: rapidTo, x: 1.0000, y: 2.0000, z: 0.0000},
				{cmd: linearTo, x: 1.0055, y: 1.8955, z: 0.0000},
				{cmd: linearTo, x: 1.0219, y: 1.7921, z: 0.0000},
				{cmd: linearTo, x: 1.0489, y: 1.6910, z: 0.0000},
				{cmd: linearTo, x: 1.0865, y: 1.5933, z: 0.0000},
				{cmd: linearTo, x: 1.1340, y: 1.5000, z: 0.0000},
				{cmd: linearTo, x: 1.1910, y: 1.4122, z: 0.0000},
				{cmd: linearTo, x: 1.2569, y: 1.3309, z: 0.0000},
				{cmd: linearTo, x: 1.3309, y: 1.2569, z: 0.0000},
				{cmd: linearTo, x: 1.4122, y: 1.1910, z: 0.0000},
				{cmd: linearTo, x: 1.5000, y: 1.1340, z: 0.0000},
				{cmd: linearTo, x: 1.5933, y: 1.0865, z: 0.0000},
				{cmd: linearTo, x: 1.6910, y: 1.0489, z: 0.0000},
				{cmd: linearTo, x: 1.7921, y: 1.0219, z: 0.0000},
				{cmd: linearTo, x: 1.8955, y: 1.0055, z: 0.0000},
				{cmd: linearTo, x: 2.0000, y: 1.0000, z: 0.0000},
			},
		},
		{s: `
G21
G18
F1
G0 Z1 X2
G2 Z2 X1 R-1 P1
`,
			actions: []action{
				{cmd: setFeed, f: 1.0},
				{cmd: rapidTo, x: 2.0000, y: 0.0000, z: 1.0000},
				{cmd: linearTo, x: 2.1001, y: 0.0000, z: 1.0050},
				{cmd: linearTo, x: 2.1992, y: 0.0000, z: 1.0200},
				{cmd: linearTo, x: 2.2963, y: 0.0000, z: 1.0449},
				{cmd: linearTo, x: 2.3904, y: 0.0000, z: 1.0794},
				{cmd: linearTo, x: 2.4806, y: 0.0000, z: 1.1231},
				{cmd: linearTo, x: 2.5659, y: 0.0000, z: 1.1756},
				{cmd: linearTo, x: 2.6456, y: 0.0000, z: 1.2363},
				{cmd: linearTo, x: 2.7188, y: 0.0000, z: 1.3048},
				{cmd: linearTo, x: 2.7848, y: 0.0000, z: 1.3803},
				{cmd: linearTo, x: 2.8429, y: 0.0000, z: 1.4619},
				{cmd: linearTo, x: 2.8925, y: 0.0000, z: 1.5490},
				{cmd: linearTo, x: 2.9332, y: 0.0000, z: 1.6406},
				{cmd: linearTo, x: 2.9645, y: 0.0000, z: 1.7358},
				{cmd: linearTo, x: 2.9861, y: 0.0000, z: 1.8337},
				{cmd: linearTo, x: 2.9978, y: 0.0000, z: 1.9332},
				{cmd: linearTo, x: 2.9994, y: 0.0000, z: 2.0334},
				{cmd: linearTo, x: 2.9911, y: 0.0000, z: 2.1333},
				{cmd: linearTo, x: 2.9728, y: 0.0000, z: 2.2318},
				{cmd: linearTo, x: 2.9447, y: 0.0000, z: 2.3280},
				{cmd: linearTo, x: 2.9071, y: 0.0000, z: 2.4209},
				{cmd: linearTo, x: 2.8604, y: 0.0000, z: 2.5096},
				{cmd: linearTo, x: 2.8051, y: 0.0000, z: 2.5932},
				{cmd: linearTo, x: 2.7417, y: 0.0000, z: 2.6708},
				{cmd: linearTo, x: 2.6708, y: 0.0000, z: 2.7417},
				{cmd: linearTo, x: 2.5932, y: 0.0000, z: 2.8051},
				{cmd: linearTo, x: 2.5096, y: 0.0000, z: 2.8604},
				{cmd: linearTo, x: 2.4209, y: 0.0000, z: 2.9071},
				{cmd: linearTo, x: 2.3280, y: 0.0000, z: 2.9447},
				{cmd: linearTo, x: 2.2318, y: 0.0000, z: 2.9728},
				{cmd: linearTo, x: 2.1333, y: 0.0000, z: 2.9911},
				{cmd: linearTo, x: 2.0334, y: 0.0000, z: 2.9994},
				{cmd: linearTo, x: 1.9332, y: 0.0000, z: 2.9978},
				{cmd: linearTo, x: 1.8337, y: 0.0000, z: 2.9861},
				{cmd: linearTo, x: 1.7358, y: 0.0000, z: 2.9645},
				{cmd: linearTo, x: 1.6406, y: 0.0000, z: 2.9332},
				{cmd: linearTo, x: 1.5490, y: 0.0000, z: 2.8925},
				{cmd: linearTo, x: 1.4619, y: 0.0000, z: 2.8429},
				{cmd: linearTo, x: 1.3803, y: 0.0000, z: 2.7848},
				{cmd: linearTo, x: 1.3048, y: 0.0000, z: 2.7188},
				{cmd: linearTo, x: 1.2363, y: 0.0000, z: 2.6456},
				{cmd: linearTo, x: 1.1756, y: 0.0000, z: 2.5659},
				{cmd: linearTo, x: 1.1231, y: 0.0000, z: 2.4806},
				{cmd: linearTo, x: 1.0794, y: 0.0000, z: 2.3904},
				{cmd: linearTo, x: 1.0449, y: 0.0000, z: 2.2963},
				{cmd: linearTo, x: 1.0200, y: 0.0000, z: 2.1992},
				{cmd: linearTo, x: 1.0050, y: 0.0000, z: 2.1001},
				{cmd: linearTo, x: 1.0000, y: 0.0000, z: 2.0000},
			},
		},
		{s: `
G21
G19
F1
G90
G0 Y1 Z2
G3 Y2 Z1 R-1 P1
`,
			actions: []action{
				{cmd: setFeed, f: 1.0},
				{cmd: rapidTo, x: 0.0000, y: 1.0000, z: 2.0000},
				{cmd: linearTo, x: 0.0000, y: 0.8999, z: 1.9950},
				{cmd: linearTo, x: 0.0000, y: 0.8008, z: 1.9800},
				{cmd: linearTo, x: 0.0000, y: 0.7037, z: 1.9551},
				{cmd: linearTo, x: 0.0000, y: 0.6096, z: 1.9206},
				{cmd: linearTo, x: 0.0000, y: 0.5194, z: 1.8769},
				{cmd: linearTo, x: 0.0000, y: 0.4341, z: 1.8244},
				{cmd: linearTo, x: 0.0000, y: 0.3544, z: 1.7637},
				{cmd: linearTo, x: 0.0000, y: 0.2812, z: 1.6952},
				{cmd: linearTo, x: 0.0000, y: 0.2152, z: 1.6197},
				{cmd: linearTo, x: 0.0000, y: 0.1571, z: 1.5381},
				{cmd: linearTo, x: 0.0000, y: 0.1075, z: 1.4510},
				{cmd: linearTo, x: 0.0000, y: 0.0668, z: 1.3594},
				{cmd: linearTo, x: 0.0000, y: 0.0355, z: 1.2642},
				{cmd: linearTo, x: 0.0000, y: 0.0139, z: 1.1663},
				{cmd: linearTo, x: 0.0000, y: 0.0022, z: 1.0668},
				{cmd: linearTo, x: 0.0000, y: 0.0006, z: 0.9666},
				{cmd: linearTo, x: 0.0000, y: 0.0089, z: 0.8667},
				{cmd: linearTo, x: 0.0000, y: 0.0272, z: 0.7682},
				{cmd: linearTo, x: 0.0000, y: 0.0553, z: 0.6720},
				{cmd: linearTo, x: 0.0000, y: 0.0929, z: 0.5791},
				{cmd: linearTo, x: 0.0000, y: 0.1396, z: 0.4904},
				{cmd: linearTo, x: 0.0000, y: 0.1949, z: 0.4068},
				{cmd: linearTo, x: 0.0000, y: 0.2583, z: 0.3292},
				{cmd: linearTo, x: 0.0000, y: 0.3292, z: 0.2583},
				{cmd: linearTo, x: 0.0000, y: 0.4068, z: 0.1949},
				{cmd: linearTo, x: 0.0000, y: 0.4904, z: 0.1396},
				{cmd: linearTo, x: 0.0000, y: 0.5791, z: 0.0929},
				{cmd: linearTo, x: 0.0000, y: 0.6720, z: 0.0553},
				{cmd: linearTo, x: 0.0000, y: 0.7682, z: 0.0272},
				{cmd: linearTo, x: 0.0000, y: 0.8667, z: 0.0089},
				{cmd: linearTo, x: 0.0000, y: 0.9666, z: 0.0006},
				{cmd: linearTo, x: 0.0000, y: 1.0668, z: 0.0022},
				{cmd: linearTo, x: 0.0000, y: 1.1663, z: 0.0139},
				{cmd: linearTo, x: 0.0000, y: 1.2642, z: 0.0355},
				{cmd: linearTo, x: 0.0000, y: 1.3594, z: 0.0668},
				{cmd: linearTo, x: 0.0000, y: 1.4510, z: 0.1075},
				{cmd: linearTo, x: 0.0000, y: 1.5381, z: 0.1571},
				{cmd: linearTo, x: 0.0000, y: 1.6197, z: 0.2152},
				{cmd: linearTo, x: 0.0000, y: 1.6952, z: 0.2812},
				{cmd: linearTo, x: 0.0000, y: 1.7637, z: 0.3544},
				{cmd: linearTo, x: 0.0000, y: 1.8244, z: 0.4341},
				{cmd: linearTo, x: 0.0000, y: 1.8769, z: 0.5194},
				{cmd: linearTo, x: 0.0000, y: 1.9206, z: 0.6096},
				{cmd: linearTo, x: 0.0000, y: 1.9551, z: 0.7037},
				{cmd: linearTo, x: 0.0000, y: 1.9800, z: 0.8008},
				{cmd: linearTo, x: 0.0000, y: 1.9950, z: 0.8999},
				{cmd: linearTo, x: 0.0000, y: 2.0000, z: 1.0000},
			},
		},
		{s: `
G21
G17
F1
G0 X2
G2 J1 Z1
`,
			actions: []action{
				{cmd: setFeed, f: 1.0},
				{cmd: rapidTo, x: 2.0000, y: 0.0000, z: 0.0000},
				{cmd: linearTo, x: 1.9004, y: 0.0050, z: 0.0159},
				{cmd: linearTo, x: 1.8019, y: 0.0198, z: 0.0317},
				{cmd: linearTo, x: 1.7052, y: 0.0444, z: 0.0476},
				{cmd: linearTo, x: 1.6116, y: 0.0785, z: 0.0635},
				{cmd: linearTo, x: 1.5217, y: 0.1218, z: 0.0794},
				{cmd: linearTo, x: 1.4367, y: 0.1738, z: 0.0952},
				{cmd: linearTo, x: 1.3572, y: 0.2340, z: 0.1111},
				{cmd: linearTo, x: 1.2841, y: 0.3018, z: 0.1270},
				{cmd: linearTo, x: 1.2182, y: 0.3765, z: 0.1429},
				{cmd: linearTo, x: 1.1600, y: 0.4575, z: 0.1587},
				{cmd: linearTo, x: 1.1101, y: 0.5438, z: 0.1746},
				{cmd: linearTo, x: 1.0691, y: 0.6347, z: 0.1905},
				{cmd: linearTo, x: 1.0374, y: 0.7292, z: 0.2063},
				{cmd: linearTo, x: 1.0152, y: 0.8264, z: 0.2222},
				{cmd: linearTo, x: 1.0028, y: 0.9253, z: 0.2381},
				{cmd: linearTo, x: 1.0003, y: 1.0249, z: 0.2540},
				{cmd: linearTo, x: 1.0078, y: 1.1243, z: 0.2698},
				{cmd: linearTo, x: 1.0251, y: 1.2225, z: 0.2857},
				{cmd: linearTo, x: 1.0521, y: 1.3185, z: 0.3016},
				{cmd: linearTo, x: 1.0885, y: 1.4113, z: 0.3175},
				{cmd: linearTo, x: 1.1340, y: 1.5000, z: 0.3333},
				{cmd: linearTo, x: 1.1881, y: 1.5837, z: 0.3492},
				{cmd: linearTo, x: 1.2502, y: 1.6617, z: 0.3651},
				{cmd: linearTo, x: 1.3198, y: 1.7331, z: 0.3810},
				{cmd: linearTo, x: 1.3962, y: 1.7971, z: 0.3968},
				{cmd: linearTo, x: 1.4786, y: 1.8533, z: 0.4127},
				{cmd: linearTo, x: 1.5661, y: 1.9010, z: 0.4286},
				{cmd: linearTo, x: 1.6580, y: 1.9397, z: 0.4444},
				{cmd: linearTo, x: 1.7532, y: 1.9691, z: 0.4603},
				{cmd: linearTo, x: 1.8510, y: 1.9888, z: 0.4762},
				{cmd: linearTo, x: 1.9502, y: 1.9988, z: 0.4921},
				{cmd: linearTo, x: 2.0498, y: 1.9988, z: 0.5079},
				{cmd: linearTo, x: 2.1490, y: 1.9888, z: 0.5238},
				{cmd: linearTo, x: 2.2468, y: 1.9691, z: 0.5397},
				{cmd: linearTo, x: 2.3420, y: 1.9397, z: 0.5556},
				{cmd: linearTo, x: 2.4339, y: 1.9010, z: 0.5714},
				{cmd: linearTo, x: 2.5214, y: 1.8533, z: 0.5873},
				{cmd: linearTo, x: 2.6038, y: 1.7971, z: 0.6032},
				{cmd: linearTo, x: 2.6802, y: 1.7331, z: 0.6190},
				{cmd: linearTo, x: 2.7498, y: 1.6617, z: 0.6349},
				{cmd: linearTo, x: 2.8119, y: 1.5837, z: 0.6508},
				{cmd: linearTo, x: 2.8660, y: 1.5000, z: 0.6667},
				{cmd: linearTo, x: 2.9115, y: 1.4113, z: 0.6825},
				{cmd: linearTo, x: 2.9479, y: 1.3185, z: 0.6984},
				{cmd: linearTo, x: 2.9749, y: 1.2225, z: 0.7143},
				{cmd: linearTo, x: 2.9922, y: 1.1243, z: 0.7302},
				{cmd: linearTo, x: 2.9997, y: 1.0249, z: 0.7460},
				{cmd: linearTo, x: 2.9972, y: 0.9253, z: 0.7619},
				{cmd: linearTo, x: 2.9848, y: 0.8264, z: 0.7778},
				{cmd: linearTo, x: 2.9626, y: 0.7292, z: 0.7937},
				{cmd: linearTo, x: 2.9309, y: 0.6347, z: 0.8095},
				{cmd: linearTo, x: 2.8899, y: 0.5438, z: 0.8254},
				{cmd: linearTo, x: 2.8400, y: 0.4575, z: 0.8413},
				{cmd: linearTo, x: 2.7818, y: 0.3765, z: 0.8571},
				{cmd: linearTo, x: 2.7159, y: 0.3018, z: 0.8730},
				{cmd: linearTo, x: 2.6428, y: 0.2340, z: 0.8889},
				{cmd: linearTo, x: 2.5633, y: 0.1738, z: 0.9048},
				{cmd: linearTo, x: 2.4783, y: 0.1218, z: 0.9206},
				{cmd: linearTo, x: 2.3884, y: 0.0785, z: 0.9365},
				{cmd: linearTo, x: 2.2948, y: 0.0444, z: 0.9524},
				{cmd: linearTo, x: 2.1981, y: 0.0198, z: 0.9683},
				{cmd: linearTo, x: 2.0996, y: 0.0050, z: 0.9841},
				{cmd: linearTo, x: 2.0000, y: 0.0000, z: 1.0000},
			},
		},
		{s: `
G21
G18
F1
G0 Z1 X1
G90.1
G3 I2 K1 Y2 P2
`,
			actions: []action{
				{cmd: setFeed, f: 1.0},
				{cmd: rapidTo, x: 1.0000, y: 0.0000, z: 1.0000},
				{cmd: linearTo, x: 1.0049, y: 0.0157, z: 1.0988},
				{cmd: linearTo, x: 1.0195, y: 0.0315, z: 1.1966},
				{cmd: linearTo, x: 1.0437, y: 0.0472, z: 1.2925},
				{cmd: linearTo, x: 1.0773, y: 0.0630, z: 1.3855},
				{cmd: linearTo, x: 1.1199, y: 0.0787, z: 1.4748},
				{cmd: linearTo, x: 1.1711, y: 0.0945, z: 1.5594},
				{cmd: linearTo, x: 1.2304, y: 0.1102, z: 1.6386},
				{cmd: linearTo, x: 1.2973, y: 0.1260, z: 1.7115},
				{cmd: linearTo, x: 1.3710, y: 0.1417, z: 1.7774},
				{cmd: linearTo, x: 1.4509, y: 0.1575, z: 1.8357},
				{cmd: linearTo, x: 1.5361, y: 0.1732, z: 1.8859},
				{cmd: linearTo, x: 1.6259, y: 0.1890, z: 1.9274},
				{cmd: linearTo, x: 1.7193, y: 0.2047, z: 1.9598},
				{cmd: linearTo, x: 1.8155, y: 0.2205, z: 1.9828},
				{cmd: linearTo, x: 1.9135, y: 0.2362, z: 1.9963},
				{cmd: linearTo, x: 2.0124, y: 0.2520, z: 1.9999},
				{cmd: linearTo, x: 2.1111, y: 0.2677, z: 1.9938},
				{cmd: linearTo, x: 2.2087, y: 0.2835, z: 1.9780},
				{cmd: linearTo, x: 2.3043, y: 0.2992, z: 1.9526},
				{cmd: linearTo, x: 2.3969, y: 0.3150, z: 1.9179},
				{cmd: linearTo, x: 2.4857, y: 0.3307, z: 1.8742},
				{cmd: linearTo, x: 2.5696, y: 0.3465, z: 1.8219},
				{cmd: linearTo, x: 2.6480, y: 0.3622, z: 1.7616},
				{cmd: linearTo, x: 2.7201, y: 0.3780, z: 1.6939},
				{cmd: linearTo, x: 2.7851, y: 0.3937, z: 1.6193},
				{cmd: linearTo, x: 2.8425, y: 0.4094, z: 1.5387},
				{cmd: linearTo, x: 2.8916, y: 0.4252, z: 1.4529},
				{cmd: linearTo, x: 2.9319, y: 0.4409, z: 1.3626},
				{cmd: linearTo, x: 2.9632, y: 0.4567, z: 1.2688},
				{cmd: linearTo, x: 2.9850, y: 0.4724, z: 1.1723},
				{cmd: linearTo, x: 2.9972, y: 0.4882, z: 1.0741},
				{cmd: linearTo, x: 2.9997, y: 0.5039, z: 0.9753},
				{cmd: linearTo, x: 2.9924, y: 0.5197, z: 0.8766},
				{cmd: linearTo, x: 2.9753, y: 0.5354, z: 0.7792},
				{cmd: linearTo, x: 2.9487, y: 0.5512, z: 0.6839},
				{cmd: linearTo, x: 2.9129, y: 0.5669, z: 0.5918},
				{cmd: linearTo, x: 2.8681, y: 0.5827, z: 0.5036},
				{cmd: linearTo, x: 2.8148, y: 0.5984, z: 0.4202},
				{cmd: linearTo, x: 2.7535, y: 0.6142, z: 0.3426},
				{cmd: linearTo, x: 2.6849, y: 0.6299, z: 0.2714},
				{cmd: linearTo, x: 2.6096, y: 0.6457, z: 0.2073},
				{cmd: linearTo, x: 2.5283, y: 0.6614, z: 0.1509},
				{cmd: linearTo, x: 2.4418, y: 0.6772, z: 0.1029},
				{cmd: linearTo, x: 2.3510, y: 0.6929, z: 0.0636},
				{cmd: linearTo, x: 2.2568, y: 0.7087, z: 0.0335},
				{cmd: linearTo, x: 2.1601, y: 0.7244, z: 0.0129},
				{cmd: linearTo, x: 2.0618, y: 0.7402, z: 0.0019},
				{cmd: linearTo, x: 1.9629, y: 0.7559, z: 0.0007},
				{cmd: linearTo, x: 1.8644, y: 0.7717, z: 0.0092},
				{cmd: linearTo, x: 1.7672, y: 0.7874, z: 0.0275},
				{cmd: linearTo, x: 1.6722, y: 0.8031, z: 0.0552},
				{cmd: linearTo, x: 1.5805, y: 0.8189, z: 0.0922},
				{cmd: linearTo, x: 1.4929, y: 0.8346, z: 0.1381},
				{cmd: linearTo, x: 1.4102, y: 0.8504, z: 0.1924},
				{cmd: linearTo, x: 1.3333, y: 0.8661, z: 0.2547},
				{cmd: linearTo, x: 1.2630, y: 0.8819, z: 0.3242},
				{cmd: linearTo, x: 1.1998, y: 0.8976, z: 0.4003},
				{cmd: linearTo, x: 1.1445, y: 0.9134, z: 0.4823},
				{cmd: linearTo, x: 1.0975, y: 0.9291, z: 0.5693},
				{cmd: linearTo, x: 1.0594, y: 0.9449, z: 0.6606},
				{cmd: linearTo, x: 1.0304, y: 0.9606, z: 0.7551},
				{cmd: linearTo, x: 1.0110, y: 0.9764, z: 0.8521},
				{cmd: linearTo, x: 1.0012, y: 0.9921, z: 0.9505},
				{cmd: linearTo, x: 1.0012, y: 1.0079, z: 1.0495},
				{cmd: linearTo, x: 1.0110, y: 1.0236, z: 1.1479},
				{cmd: linearTo, x: 1.0304, y: 1.0394, z: 1.2449},
				{cmd: linearTo, x: 1.0594, y: 1.0551, z: 1.3394},
				{cmd: linearTo, x: 1.0975, y: 1.0709, z: 1.4307},
				{cmd: linearTo, x: 1.1445, y: 1.0866, z: 1.5177},
				{cmd: linearTo, x: 1.1998, y: 1.1024, z: 1.5997},
				{cmd: linearTo, x: 1.2630, y: 1.1181, z: 1.6758},
				{cmd: linearTo, x: 1.3333, y: 1.1339, z: 1.7453},
				{cmd: linearTo, x: 1.4102, y: 1.1496, z: 1.8076},
				{cmd: linearTo, x: 1.4929, y: 1.1654, z: 1.8619},
				{cmd: linearTo, x: 1.5805, y: 1.1811, z: 1.9078},
				{cmd: linearTo, x: 1.6722, y: 1.1969, z: 1.9448},
				{cmd: linearTo, x: 1.7672, y: 1.2126, z: 1.9725},
				{cmd: linearTo, x: 1.8644, y: 1.2283, z: 1.9908},
				{cmd: linearTo, x: 1.9629, y: 1.2441, z: 1.9993},
				{cmd: linearTo, x: 2.0618, y: 1.2598, z: 1.9981},
				{cmd: linearTo, x: 2.1601, y: 1.2756, z: 1.9871},
				{cmd: linearTo, x: 2.2568, y: 1.2913, z: 1.9665},
				{cmd: linearTo, x: 2.3510, y: 1.3071, z: 1.9364},
				{cmd: linearTo, x: 2.4418, y: 1.3228, z: 1.8971},
				{cmd: linearTo, x: 2.5283, y: 1.3386, z: 1.8491},
				{cmd: linearTo, x: 2.6096, y: 1.3543, z: 1.7927},
				{cmd: linearTo, x: 2.6849, y: 1.3701, z: 1.7286},
				{cmd: linearTo, x: 2.7535, y: 1.3858, z: 1.6574},
				{cmd: linearTo, x: 2.8148, y: 1.4016, z: 1.5798},
				{cmd: linearTo, x: 2.8681, y: 1.4173, z: 1.4964},
				{cmd: linearTo, x: 2.9129, y: 1.4331, z: 1.4082},
				{cmd: linearTo, x: 2.9487, y: 1.4488, z: 1.3161},
				{cmd: linearTo, x: 2.9753, y: 1.4646, z: 1.2208},
				{cmd: linearTo, x: 2.9924, y: 1.4803, z: 1.1234},
				{cmd: linearTo, x: 2.9997, y: 1.4961, z: 1.0247},
				{cmd: linearTo, x: 2.9972, y: 1.5118, z: 0.9259},
				{cmd: linearTo, x: 2.9850, y: 1.5276, z: 0.8277},
				{cmd: linearTo, x: 2.9632, y: 1.5433, z: 0.7312},
				{cmd: linearTo, x: 2.9319, y: 1.5591, z: 0.6374},
				{cmd: linearTo, x: 2.8916, y: 1.5748, z: 0.5471},
				{cmd: linearTo, x: 2.8425, y: 1.5906, z: 0.4613},
				{cmd: linearTo, x: 2.7851, y: 1.6063, z: 0.3807},
				{cmd: linearTo, x: 2.7201, y: 1.6220, z: 0.3061},
				{cmd: linearTo, x: 2.6480, y: 1.6378, z: 0.2384},
				{cmd: linearTo, x: 2.5696, y: 1.6535, z: 0.1781},
				{cmd: linearTo, x: 2.4857, y: 1.6693, z: 0.1258},
				{cmd: linearTo, x: 2.3969, y: 1.6850, z: 0.0821},
				{cmd: linearTo, x: 2.3043, y: 1.7008, z: 0.0474},
				{cmd: linearTo, x: 2.2087, y: 1.7165, z: 0.0220},
				{cmd: linearTo, x: 2.1111, y: 1.7323, z: 0.0062},
				{cmd: linearTo, x: 2.0124, y: 1.7480, z: 0.0001},
				{cmd: linearTo, x: 1.9135, y: 1.7638, z: 0.0037},
				{cmd: linearTo, x: 1.8155, y: 1.7795, z: 0.0172},
				{cmd: linearTo, x: 1.7193, y: 1.7953, z: 0.0402},
				{cmd: linearTo, x: 1.6259, y: 1.8110, z: 0.0726},
				{cmd: linearTo, x: 1.5361, y: 1.8268, z: 0.1141},
				{cmd: linearTo, x: 1.4509, y: 1.8425, z: 0.1643},
				{cmd: linearTo, x: 1.3710, y: 1.8583, z: 0.2226},
				{cmd: linearTo, x: 1.2973, y: 1.8740, z: 0.2885},
				{cmd: linearTo, x: 1.2304, y: 1.8898, z: 0.3614},
				{cmd: linearTo, x: 1.1711, y: 1.9055, z: 0.4406},
				{cmd: linearTo, x: 1.1199, y: 1.9213, z: 0.5252},
				{cmd: linearTo, x: 1.0773, y: 1.9370, z: 0.6145},
				{cmd: linearTo, x: 1.0437, y: 1.9528, z: 0.7075},
				{cmd: linearTo, x: 1.0195, y: 1.9685, z: 0.8034},
				{cmd: linearTo, x: 1.0049, y: 1.9843, z: 0.9012},
				{cmd: linearTo, x: 1.0000, y: 2.0000, z: 1.0000},
			},
		},
		{s: `
G21
G19
F1
G91.1
G0 Y1 Z2
G2 J1 Y2 Z1
`,
			actions: []action{
				{cmd: setFeed, f: 1.0},
				{cmd: rapidTo, x: 0.0000, y: 1.0000, z: 2.0000},
				{cmd: linearTo, x: 0.0000, y: 1.0050, z: 2.1001},
				{cmd: linearTo, x: 0.0000, y: 1.0200, z: 2.1992},
				{cmd: linearTo, x: 0.0000, y: 1.0449, z: 2.2963},
				{cmd: linearTo, x: 0.0000, y: 1.0794, z: 2.3904},
				{cmd: linearTo, x: 0.0000, y: 1.1231, z: 2.4806},
				{cmd: linearTo, x: 0.0000, y: 1.1756, z: 2.5659},
				{cmd: linearTo, x: 0.0000, y: 1.2363, z: 2.6456},
				{cmd: linearTo, x: 0.0000, y: 1.3048, z: 2.7188},
				{cmd: linearTo, x: 0.0000, y: 1.3803, z: 2.7848},
				{cmd: linearTo, x: 0.0000, y: 1.4619, z: 2.8429},
				{cmd: linearTo, x: 0.0000, y: 1.5490, z: 2.8925},
				{cmd: linearTo, x: 0.0000, y: 1.6406, z: 2.9332},
				{cmd: linearTo, x: 0.0000, y: 1.7358, z: 2.9645},
				{cmd: linearTo, x: 0.0000, y: 1.8337, z: 2.9861},
				{cmd: linearTo, x: 0.0000, y: 1.9332, z: 2.9978},
				{cmd: linearTo, x: 0.0000, y: 2.0334, z: 2.9994},
				{cmd: linearTo, x: 0.0000, y: 2.1333, z: 2.9911},
				{cmd: linearTo, x: 0.0000, y: 2.2318, z: 2.9728},
				{cmd: linearTo, x: 0.0000, y: 2.3280, z: 2.9447},
				{cmd: linearTo, x: 0.0000, y: 2.4209, z: 2.9071},
				{cmd: linearTo, x: 0.0000, y: 2.5096, z: 2.8604},
				{cmd: linearTo, x: 0.0000, y: 2.5932, z: 2.8051},
				{cmd: linearTo, x: 0.0000, y: 2.6708, z: 2.7417},
				{cmd: linearTo, x: 0.0000, y: 2.7417, z: 2.6708},
				{cmd: linearTo, x: 0.0000, y: 2.8051, z: 2.5932},
				{cmd: linearTo, x: 0.0000, y: 2.8604, z: 2.5096},
				{cmd: linearTo, x: 0.0000, y: 2.9071, z: 2.4209},
				{cmd: linearTo, x: 0.0000, y: 2.9447, z: 2.3280},
				{cmd: linearTo, x: 0.0000, y: 2.9728, z: 2.2318},
				{cmd: linearTo, x: 0.0000, y: 2.9911, z: 2.1333},
				{cmd: linearTo, x: 0.0000, y: 2.9994, z: 2.0334},
				{cmd: linearTo, x: 0.0000, y: 2.9978, z: 1.9332},
				{cmd: linearTo, x: 0.0000, y: 2.9861, z: 1.8337},
				{cmd: linearTo, x: 0.0000, y: 2.9645, z: 1.7358},
				{cmd: linearTo, x: 0.0000, y: 2.9332, z: 1.6406},
				{cmd: linearTo, x: 0.0000, y: 2.8925, z: 1.5490},
				{cmd: linearTo, x: 0.0000, y: 2.8429, z: 1.4619},
				{cmd: linearTo, x: 0.0000, y: 2.7848, z: 1.3803},
				{cmd: linearTo, x: 0.0000, y: 2.7188, z: 1.3048},
				{cmd: linearTo, x: 0.0000, y: 2.6456, z: 1.2363},
				{cmd: linearTo, x: 0.0000, y: 2.5659, z: 1.1756},
				{cmd: linearTo, x: 0.0000, y: 2.4806, z: 1.1231},
				{cmd: linearTo, x: 0.0000, y: 2.3904, z: 1.0794},
				{cmd: linearTo, x: 0.0000, y: 2.2963, z: 1.0449},
				{cmd: linearTo, x: 0.0000, y: 2.1992, z: 1.0200},
				{cmd: linearTo, x: 0.0000, y: 2.1001, z: 1.0050},
				{cmd: linearTo, x: 0.0000, y: 2.0000, z: 1.0000},
			},
		},
		{s: `
G21
G19
F1
G91.1
G0 Y1 Z2
G3 J1 Y2 Z1
`,
			actions: []action{
				{cmd: setFeed, f: 1.0},
				{cmd: rapidTo, x: 0.0000, y: 1.0000, z: 2.0000},
				{cmd: linearTo, x: 0.0000, y: 1.0055, z: 1.8955},
				{cmd: linearTo, x: 0.0000, y: 1.0219, z: 1.7921},
				{cmd: linearTo, x: 0.0000, y: 1.0489, z: 1.6910},
				{cmd: linearTo, x: 0.0000, y: 1.0865, z: 1.5933},
				{cmd: linearTo, x: 0.0000, y: 1.1340, z: 1.5000},
				{cmd: linearTo, x: 0.0000, y: 1.1910, z: 1.4122},
				{cmd: linearTo, x: 0.0000, y: 1.2569, z: 1.3309},
				{cmd: linearTo, x: 0.0000, y: 1.3309, z: 1.2569},
				{cmd: linearTo, x: 0.0000, y: 1.4122, z: 1.1910},
				{cmd: linearTo, x: 0.0000, y: 1.5000, z: 1.1340},
				{cmd: linearTo, x: 0.0000, y: 1.5933, z: 1.0865},
				{cmd: linearTo, x: 0.0000, y: 1.6910, z: 1.0489},
				{cmd: linearTo, x: 0.0000, y: 1.7921, z: 1.0219},
				{cmd: linearTo, x: 0.0000, y: 1.8955, z: 1.0055},
				{cmd: linearTo, x: 0.0000, y: 2.0000, z: 1.0000},
			},
		},
		{s: `
G21
G17
G0 X1 Y1
G2 F1 X2 Y1 R1
F1 X3 R1
I0.5 J-1 X4
X5 R1
`,
			actions: []action{
				{cmd: rapidTo, x: 1.0000, y: 1.0000, z: 0.0000},
				{cmd: setFeed, f: 1.0},
				{cmd: linearTo, x: 1.0933, y: 1.0475, z: 0.0000},
				{cmd: linearTo, x: 1.1910, y: 1.0850, z: 0.0000},
				{cmd: linearTo, x: 1.2921, y: 1.1121, z: 0.0000},
				{cmd: linearTo, x: 1.3955, y: 1.1285, z: 0.0000},
				{cmd: linearTo, x: 1.5000, y: 1.1340, z: 0.0000},
				{cmd: linearTo, x: 1.6045, y: 1.1285, z: 0.0000},
				{cmd: linearTo, x: 1.7079, y: 1.1121, z: 0.0000},
				{cmd: linearTo, x: 1.8090, y: 1.0850, z: 0.0000},
				{cmd: linearTo, x: 1.9067, y: 1.0475, z: 0.0000},
				{cmd: linearTo, x: 2.0000, y: 1.0000, z: 0.0000},
				{cmd: setFeed, f: 1.0},
				{cmd: linearTo, x: 2.0933, y: 1.0475, z: 0.0000},
				{cmd: linearTo, x: 2.1910, y: 1.0850, z: 0.0000},
				{cmd: linearTo, x: 2.2921, y: 1.1121, z: 0.0000},
				{cmd: linearTo, x: 2.3955, y: 1.1285, z: 0.0000},
				{cmd: linearTo, x: 2.5000, y: 1.1340, z: 0.0000},
				{cmd: linearTo, x: 2.6045, y: 1.1285, z: 0.0000},
				{cmd: linearTo, x: 2.7079, y: 1.1121, z: 0.0000},
				{cmd: linearTo, x: 2.8090, y: 1.0850, z: 0.0000},
				{cmd: linearTo, x: 2.9067, y: 1.0475, z: 0.0000},
				{cmd: linearTo, x: 3.0000, y: 1.0000, z: 0.0000},
				{cmd: linearTo, x: 3.0947, y: 1.0420, z: 0.0000},
				{cmd: linearTo, x: 3.1930, y: 1.0751, z: 0.0000},
				{cmd: linearTo, x: 3.2938, y: 1.0989, z: 0.0000},
				{cmd: linearTo, x: 3.3965, y: 1.1132, z: 0.0000},
				{cmd: linearTo, x: 3.5000, y: 1.1180, z: 0.0000},
				{cmd: linearTo, x: 3.6035, y: 1.1132, z: 0.0000},
				{cmd: linearTo, x: 3.7062, y: 1.0989, z: 0.0000},
				{cmd: linearTo, x: 3.8070, y: 1.0751, z: 0.0000},
				{cmd: linearTo, x: 3.9053, y: 1.0420, z: 0.0000},
				{cmd: linearTo, x: 4.0000, y: 1.0000, z: 0.0000},
				{cmd: linearTo, x: 4.0933, y: 1.0475, z: 0.0000},
				{cmd: linearTo, x: 4.1910, y: 1.0850, z: 0.0000},
				{cmd: linearTo, x: 4.2921, y: 1.1121, z: 0.0000},
				{cmd: linearTo, x: 4.3955, y: 1.1285, z: 0.0000},
				{cmd: linearTo, x: 4.5000, y: 1.1340, z: 0.0000},
				{cmd: linearTo, x: 4.6045, y: 1.1285, z: 0.0000},
				{cmd: linearTo, x: 4.7079, y: 1.1121, z: 0.0000},
				{cmd: linearTo, x: 4.8090, y: 1.0850, z: 0.0000},
				{cmd: linearTo, x: 4.9067, y: 1.0475, z: 0.0000},
				{cmd: linearTo, x: 5.0000, y: 1.0000, z: 0.0000},
			},
		},
		{s: `
G21
G17
F1
G0 X1 Y1
G2 X3 Y1 R0.99999
`,
			actions: []action{
				{cmd: setFeed, f: 1.0},
				{cmd: rapidTo, x: 1.0000, y: 1.0000, z: 0.0000},
				{cmd: linearTo, x: 1.0051, y: 1.1012, z: 0.0000},
				{cmd: linearTo, x: 1.0205, y: 1.2013, z: 0.0000},
				{cmd: linearTo, x: 1.0459, y: 1.2994, z: 0.0000},
				{cmd: linearTo, x: 1.0811, y: 1.3944, z: 0.0000},
				{cmd: linearTo, x: 1.1257, y: 1.4853, z: 0.0000},
				{cmd: linearTo, x: 1.1792, y: 1.5713, z: 0.0000},
				{cmd: linearTo, x: 1.2412, y: 1.6514, z: 0.0000},
				{cmd: linearTo, x: 1.3110, y: 1.7248, z: 0.0000},
				{cmd: linearTo, x: 1.3879, y: 1.7908, z: 0.0000},
				{cmd: linearTo, x: 1.4710, y: 1.8486, z: 0.0000},
				{cmd: linearTo, x: 1.5596, y: 1.8978, z: 0.0000},
				{cmd: linearTo, x: 1.6527, y: 1.9377, z: 0.0000},
				{cmd: linearTo, x: 1.7493, y: 1.9681, z: 0.0000},
				{cmd: linearTo, x: 1.8486, y: 1.9885, z: 0.0000},
				{cmd: linearTo, x: 1.9494, y: 1.9987, z: 0.0000},
				{cmd: linearTo, x: 2.0506, y: 1.9987, z: 0.0000},
				{cmd: linearTo, x: 2.1514, y: 1.9885, z: 0.0000},
				{cmd: linearTo, x: 2.2507, y: 1.9681, z: 0.0000},
				{cmd: linearTo, x: 2.3473, y: 1.9377, z: 0.0000},
				{cmd: linearTo, x: 2.4404, y: 1.8978, z: 0.0000},
				{cmd: linearTo, x: 2.5290, y: 1.8486, z: 0.0000},
				{cmd: linearTo, x: 2.6121, y: 1.7908, z: 0.0000},
				{cmd: linearTo, x: 2.6890, y: 1.7248, z: 0.0000},
				{cmd: linearTo, x: 2.7588, y: 1.6514, z: 0.0000},
				{cmd: linearTo, x: 2.8208, y: 1.5713, z: 0.0000},
				{cmd: linearTo, x: 2.8743, y: 1.4853, z: 0.0000},
				{cmd: linearTo, x: 2.9189, y: 1.3944, z: 0.0000},
				{cmd: linearTo, x: 2.9541, y: 1.2994, z: 0.0000},
				{cmd: linearTo, x: 2.9795, y: 1.2013, z: 0.0000},
				{cmd: linearTo, x: 2.9949, y: 1.1012, z: 0.0000},
				{cmd: linearTo, x: 3.0000, y: 1.0000, z: 0.0000},
			},
		},
	}

	for i, c := range cases {
		eng := gcode.NewEngine(&machine{actions: c.actions}, gcode.AllFeatures, os.Stdout,
			os.Stderr)
		err := eng.Evaluate(strings.NewReader(c.s))
		if err != nil {
			t.Errorf("Evaluate(%d) failed: %s", i, err)
		}
	}
}

func TestArcFail(t *testing.T) {
	cases := []string{
		"G0 X0 Y0\nG2 R2\n",
		"G0 X0 Y0\nG2 R1 X2.1\n",
		"G0 X0 Y0\nG2 I1 J2 R1\n",
		"G0 X0 Y0\nG2 P2\n",
		"G17\nG2 K1\n",
		"G18\nG2 J1\n",
		"G19\nG2 I1\n",
		"G2 P0\n",
		"G2 P-1\n",
		"G2 P1.5\n",
		"G90.1\nG17\nG2 I1\n",
		"G90.1\nG17\nG2 J1\n",
		"G90.1\nG18\nG2 I1\n",
		"G90.1\nG18\nG2 K1\n",
		"G90.1\nG19\nG2 J1\n",
		"G90.1\nG19\nG2 K1\n",
	}

	for _, c := range cases {
		eng := gcode.NewEngine(&machine{}, gcode.AllFeatures, os.Stdout, os.Stderr)
		err := eng.Evaluate(strings.NewReader(c))
		if err == nil {
			t.Errorf("Evaluate(%s) did not fail", c)
		}
	}
}
